"use strict";!function(){var t=ax5.ui,e=ax5.util,i=void 0;t.addClass({className:"uploader",version:"1.3.53"},function(){var s=function(){var s=this,o=void 0;this.instanceId=ax5.getGuid(),this.config={clickEventName:"click",theme:"default",lang:{upload:"Upload",abort:"Abort"},animateTime:100,accept:"*/*",multiple:!1,manualUpload:!1,progressBox:!0},this.defaultBtns={upload:{label:this.config.lang.upload,theme:"btn-primary"},abort:{label:this.config.lang.abort,theme:this.config.theme}},this.uploadedFiles=[],this.$target=null,this.$inputContainer=null,this.$inputFile=null,this.$inputFileForm=null,this.$fileSelector=null,this.$dropZone=null,this.__uploading=!1,this.selectedFiles=[],this.selectedFilesTotal=0,this.__loaded=0,o=this.config;var r=function(t){return o.onStateChanged?o.onStateChanged.call(t,t):this.onStateChanged&&this.onStateChanged.call(t,t),t=null,!0},n=function(t){var i=void 0;return ax5.info.supportFileApi&&("dataTransfer"in t?i=t.dataTransfer.files:"target"in t?i=t.target.files:t&&(i=t)),!!i&&(length in i?this.selectedFiles=e.toArray(i):this.selectedFiles=[i],o.progressBox&&h(),void(o.manualUpload||this.send()))},a=function(){this.$fileSelector.off("click.ax5uploader").on("click.ax5uploader",function(){this.$inputFile.trigger("click")}.bind(this)),this.$inputFile.off("change.ax5uploader").on("change.ax5uploader",function(t){n.call(this,t)}.bind(this)),function(){return!1}.call(this)},l=function(){},d=function(t){var e=function(){var e=jQuery(window),i=jQuery(document.body),s={},r=6,n={},a={},l=void 0;s=this.$progressBox.parent().get(0)==this.$target.get(0)?this.$fileSelector.position():this.$fileSelector.offset(),n={width:this.$fileSelector.outerWidth(),height:this.$fileSelector.outerHeight()},a={winWidth:Math.max(e.width(),i.width()),winHeight:Math.max(e.height(),i.height()),width:this.$progressBox.outerWidth(),height:this.$progressBox.outerHeight()},o.direction&&""!==o.direction&&"auto"!==o.direction?l=o.direction:(l="top",s.top-a.height-r<0?l="top":s.top+n.height+a.height+r>a.winHeight&&(l="bottom")),t&&this.$progressBox.addClass("direction-"+l);var d=function(){var t={left:0,top:0};switch(l){case"top":t.left=s.left+n.width/2-a.width/2,t.top=s.top+n.height+r;break;case"bottom":t.left=s.left+n.width/2-a.width/2,t.top=s.top-a.height-r;break;case"left":t.left=s.left+n.width+r,t.top=s.top-a.height/2+n.height/2;break;case"right":t.left=s.left-a.width-r,t.top=s.top-a.height/2+n.height/2}return t}();(function(){"top"!=l&&"bottom"!=l||(d.left<0?(d.left=r,this.$progressBoxArrow.css({left:s.left+n.width/2-d.left})):d.left+a.width>a.winWidth&&(d.left=a.winWidth-a.width-r,this.$progressBoxArrow.css({left:s.left+n.width/2-d.left})))}).call(this),this.$progressBox.css(d)};this.$progressBox.css({top:-999}),t&&(function(){return o.viewport?jQuery(o.viewport.selector):this.$target}.call(this).append(this.$progressBox),this.$progressBox.off("click.ax5uploader").on("click.ax5uploader","button",function(t){var e=t.target.getAttribute("data-pregressbox-btn"),i={upload:function(){this.send()},abort:function(){this.abort()}};i[e]&&i[e].call(this)}.bind(this))),setTimeout(function(){e.call(this)}.bind(this))},h=function(){this.$progressBox.removeClass("destroy"),this.$progressUpload.removeAttr("disabled"),this.$progressAbort.removeAttr("disabled"),d.call(this,"append"),r.call(this,{self:this,state:"open"}),o.manualUpload}.bind(this),p=function(){this.$progressBox.addClass("destroy"),setTimeout(function(){this.$progressBox.remove()}.bind(this),o.animateTime)}.bind(this),u=function(){this.__uploading=!0,this.$progressUpload.attr("disabled","disabled"),this.$progressAbort.removeAttr("disabled")}.bind(this),c=function(t){this.__loaded+=t.loaded,this.$progressBar.css({width:e.number(this.__loaded/this.selectedFilesTotal*100,{round:2})+"%"}),t.lengthComputable&&t.loaded>=t.total}.bind(this),g=function(t){console.log(t)}.bind(this),f=function(){this.__uploading=!1,this.$progressUpload.removeAttr("disabled"),this.$progressAbort.attr("disabled","disabled"),o.progressBox&&p()}.bind(this),b=function(){this.xhr&&this.xhr.abort(),this.__uploading=!1,this.$progressUpload.removeAttr("disabled"),this.$progressAbort.attr("disabled","disabled"),o.progressBox&&p(),this.$inputFile.get(0).value="",console.log("cancelUpload")}.bind(this);this.init=function(t){return o=jQuery.extend(!0,{},o,t),o.target?(this.$target=jQuery(o.target),o.dropZone&&(this.$dropZone=jQuery(o.dropZone)),function(t){e.isObject(t)&&!t.error&&(o=jQuery.extend(!0,o,t))}.call(this,e.parseJson(this.$target.attr("data-ax5uploader-config"),!0)),this.$inputContainer=jQuery('<div data-ax5uploader-input-container=""></div>'),this.$target.append(this.$inputContainer),this.$fileSelector=this.$target.find('[data-ax5uploader-button="selector"]'),0===this.$fileSelector.length?(console.log(ax5.info.getError("ax5uploader","402","can not find file selector")),this):(this.$inputFile=jQuery(i.tmpl.get.call(this,"inputFile",{instanceId:this.instanceId,multiple:o.multiple,accept:o.accept})),ax5.info.supportFileApi?jQuery(document.body).append(this.$inputFile):(this.$inputFileForm=jQuery(i.tmpl.get.call(this,"inputFileForm",{instanceId:this.instanceId})),this.$inputFileForm.append(this.$inputFile),jQuery(document.body).append(this.$inputFileForm)),o.btns=jQuery.extend({},this.defaultBtns,o.btns),this.$progressBox=jQuery(i.tmpl.get.call(this,"progressBox",{instanceId:this.instanceId,btns:o.btns})),this.$progressBar=this.$progressBox.find('[role="progressbar"]'),this.$progressBoxArrow=this.$progressBox.find(".ax-progressbox-arrow"),this.$progressUpload=this.$progressBox.find('[data-pregressbox-btn="upload"]'),this.$progressAbort=this.$progressBox.find('[data-pregressbox-btn="abort"]'),l.call(this),void a.call(this))):(console.log(ax5.info.getError("ax5uploader","401","init")),this)},this.send=function(){var t={html5:function(){var t=this.selectedFiles.shift();if(!t)return f(),this;var i=new FormData;this.$target.find("input").each(function(){i.append(this.name,this.value)}),i.append(o.form.fileName,t),this.xhr=new XMLHttpRequest,this.xhr.open("post",o.form.action,!0),this.xhr.onload=function(t){var i=t.target.response;try{"string"==typeof i&&(i=e.parseJson(i))}catch(t){return console.log(t),!1}return i.error?(console.log(i.error),!1):(g(i),void s.send())},this.xhr.upload.onprogress=function(t){c(t),e.isFunction(o.onprogress)&&o.onprogress.call({loaded:t.loaded,total:t.total},t)},this.xhr.send(i)},formSubmit:function(){var t=$('<iframe src="javascript:false;" name="" style="display:none;"></iframe>');$(document.body).append(t)}};return function(){if(this.__uploading===!1){var e=0;this.selectedFiles.forEach(function(t){e+=t.size}),this.selectedFilesTotal=e,this.__loaded=0,u()}t[ax5.info.supportFileApi?"html5":"formSubmit"].call(this)}}(),this.abort=function(){return function(){b()}}(),this.main=function(){t.uploader_instance=t.uploader_instance||[],t.uploader_instance.push(this),arguments&&e.isObject(arguments[0])&&this.setConfig(arguments[0])}.apply(this,arguments)};return s}()),i=ax5.ui.uploader}(),function(){var t=ax5.ui.uploader,e=function(t){return"\n        "},i=function(t){return'<input type="file" data-ax5uploader-input="{{instanceId}}" {{#multiple}}multiple{{/multiple}} accept="{{accept}}" />'},s=function(t){return'<form data-ax5uploader-form="{{instanceId}}" method="post" enctype="multipart/form-data"></form>'},o=function(t){return'\n<div data-ax5uploader-progressbox="{{instanceId}}" class="{{theme}}">\n    <div class="ax-progressbox-body">\n        <div class="ax-pregressbox-content">\n            <div class="progress">\n              <div class="progress-bar progress-bar-striped active" role="progressbar" style="width: 0">\n                <span class="sr-only">0% Complete</span>\n              </div>\n            </div>\n        </div>\n        {{#btns}}\n            <div class="ax-progressbox-buttons">\n            {{#btns}}\n                {{#@each}}\n                <button data-pregressbox-btn="{{@key}}" class="btn btn-default {{@value.theme}}">{{@value.label}}</button>\n                {{/@each}}\n            {{/btns}}\n            </div>\n        {{/btns}}\n    </div>\n    <div class="ax-progressbox-arrow"></div>\n</div>\n'};t.tmpl={uploadProgress:e,inputFile:i,inputFileForm:s,progressBox:o,get:function(e,i,s){return ax5.mustache.render(t.tmpl[e].call(this,s),i)}}}();