"use strict";!function(){var t=ax5.ui,e=ax5.util;t.addClass({className:"uploader",version:"1.3.46"},function(){var i=function(){var i;this.instanceId=ax5.getGuid(),this.config={clickEventName:"click",theme:"default",file_types:"*/*"},this.queue=[],this.target=null,this.selectedFile=null,this.uploadedFile=null,i=this.config,this.init=function(){this.target=$(i.target),this.target.html(this.__get_layout()),this.els={container:this.target.find('[data-ui-els="container"]'),"input-file":this.target.find('[data-ui-els="input-file"]')},function(){return!1}.call(this)},this.__request_select_file=function(){return!(i.before_select_file&&!i.before_select_file.call())&&void(window.imagePicker?window.imagePicker.getPictures(function(t){for(var e=0;e<t.length;e++)console.log("Image URI: "+t[e]);_this.__on_select_file(t)},function(t){console.log("Error: "+t)}):this.els["input-file"].trigger("click"))},this.__old_select_file=function(t){var e,s=this.target.id,n=this.els["preview-img"].get(0);if("dataTransfer"in t?e=t.dataTransfer.files[0]:"target"in t?e=t.target.files[0]:t&&(e=t[0]),!e)return!1;if(this.selected_file=e,function(t){function i(e,i,s){var n={},l=new Image;l.src=e.src,l.onload=function(){this.width>this.height?this.height>s?(n={width:this.width*(s/this.height),height:s},n.left=(i-n.width)/2):(n={width:this.width,height:this.height},n.top=(s-n.height)/2):this.width>i?(n={height:this.height*(i/this.width),width:i},n.top=(s-n.height)/2):(n={width:this.width,height:this.height},n.left=(i-n.width)/2),console.log(n),t.els["preview-img"].css(n)}}if(t.els["preview-img"].css({display:"block"}),window.imagePicker)n.src=e,i(n,t.els.container.width(),t.els.container.height());else{var l=new FileReader(s);l.onloadend=function(){try{n.src=l.result,i(n,t.els.container.width(),t.els.container.height())}catch(e){console.log(e)}},e&&l.readAsDataURL(e)}}(this),i.on_event){var l={action:"fileselect",file:e};i.on_event.call(l,l)}},this.__old_upload=function(){var t=this;if(!this.selected_file){if(i.on_event){var s={action:"error",error:ax5.info.get_error("single-uploader","460","upload")};i.on_event.call(s,s)}return this}var n=new FormData,l=this.els["progress-bar"];this.els.progress.css({display:"block"}),l.css({width:"0%"}),window.imagePicker?n.append(i.upload_http.filename_param_key,this.selected_file):n.append(i.upload_http.filename_param_key,this.selected_file);for(var o in i.upload_http.data)n.append(o,i.upload_http.data[o]);this.xhr=new XMLHttpRequest,this.xhr.open(i.upload_http.method,i.upload_http.url,!0),this.xhr.onload=function(i){var s=i.target.response;try{"string"==typeof s&&(s=e.parseJson(s))}catch(i){return console.log(i),!1}return s.error?(console.log(s.error),!1):void t.upload_complete(s)},this.xhr.upload.onprogress=function(i){l.css({width:e.number(i.loaded/i.total*100,{round:2})+"%"}),i.lengthComputable&&i.loaded>=i.total&&setTimeout(function(){t.els.progress.css({display:"none"})},300)},this.xhr.send(n)},this.main=function(){t.uploader_instance=t.uploader_instance||[],t.uploader_instance.push(this),arguments&&e.isObject(arguments[0])&&this.setConfig(arguments[0])}.apply(this,arguments)};return i}())}();